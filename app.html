<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Glitch - js13kgames 2016</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <style>
body {
    background: burlywood;
    overflow: hidden;
}

#fork-on-github {
    position: absolute;
    right: 0;
    top: 0;
    transform-origin: center center 0px;
    transform: rotate(45deg) translate(0, 1em);
}

#fork-on-github a {
    background: black;
    color: white;
    display: inline-block;
    text-align: center;
    text-decoration: none;
    width: 150%;
}

#map {
    background: white;
    margin: 0 auto;
    max-width: 360px;
}

#map::after {
    clear: both;
    content: " ";
    display: block;
}

svg {
    box-sizing: border-box;
    /* https://css-tricks.com/fighting-the-space-between-inline-block-elements/ */
    display: block;
    float: left;
}

.street .car .chassis {
    fill: black;
    stroke: black;
}

.horizontal.street .car {
    transform: rotate(90deg) translate(50%, 80%);
}

.vertical.street .car {
    transform: translate(50%, 80%);
}

.left-top.curve .car,
.crossroad .car {
    animation-name: topToLeftDrive;
    transform: rotate(90deg) translate(33%, 80%);
}

.right-top.curve .car {
    animation-name: topToRightDrive;
    transform: rotate(-90deg) translate(33%, 85%);
}

.right-bottom.curve .car {
    animation-name: rightToBottomDrive;
    transform: translate(33%, 85%);
}


.left-bottom.curve .car {
    animation-name: bottomToLeftDrive;
    transform: rotate(90deg) translate(33%, 80%);
}

.horizontal.street .car {
    animation-name: horizontalDrive;
}

.vertical.street .car {
    animation-name: verticalDrive;
}

.street .car {
    animation-duration: 1s;
    transform-origin: center;
}

@keyframes topToLeftDrive {
    0% {
        transform: translate(33%, 0%);
    }
    
    40% {
        transform: translate(33%, 40%);
    }

    60% {
        transform: rotate(90deg) translate(33%, 60%);
    }

    100% {
        transform: rotate(90deg) translate(33%, 80%);
    }
}

@keyframes topToRightDrive {
    0% {
        transform: translate(33%, 0%);
    }
    
    40% {
        transform: translate(33%, 33%);
    }

    60% {
        transform: rotate(-90deg) translate(33%, 40%);
    }

    100% {
        transform: rotate(-90deg) translate(33%, 85%);
    }
}

@keyframes rightToBottomDrive {
    0% {
        transform: rotate(-90deg) translate(50%, 85%);
    }

    40% {
        transform: rotate(-90deg) translate(50%, 50%);
    }

    60% {
        transform: translate(33%, 60%);
    }
    
    100% {
        transform: translate(33%, 85%);
    }
}

@keyframes bottomToLeftDrive {
    0% {
        transform: translate(50%, 85%);
    }

    40% {
        transform: translate(50%, 60%);
    }

    60% {
        transform: rotate(90deg) translate(33%, 60%);
    }

    100% {
        transform: rotate(90deg) translate(33%, 80%);
    }
}

@keyframes horizontalDrive {
    0% {
        transform: rotate(90deg) translate(50%, 0%);
    }

    100% {
        transform: rotate(90deg) translate(50%, 80%);
    }
}

@keyframes verticalDrive {
    0% {
        transform: translate(50%, 0%);
    }

    100% {
        transform: translate(50%, 80%);
    }
}

svg path {
    fill: white;
    stroke: black;
}

svg path {
    stroke-width: 1;
}

.traffic-light .red {
    fill: red;
}

.traffic-light .yellow {
    fill: yellow;
}

.traffic-light .green {
    fill: green;
}

.crossroad .traffic-light:first-of-type {
    transform: translate(4em, 4.5em);
}

/* aka :second-of-type */
.crossroad .traffic-light:first-of-type + .traffic-light {
    transform: rotate(90deg) translate(4em, 4.5em);
    transform-origin: center;
}

/* aka :third-of-type */
.crossroad .traffic-light:first-of-type + .traffic-light + .traffic-light {
    transform: rotate(90deg);
    transform-origin: center;
}
        </style>
        <meta name="description"
              content="Ryuno-Ki's contribution to js13kgames of 2016" />
    </head>
    <body>
        <div id="map"></div>
        <p id="fork-on-github">
            <a href="https://github.com/Ryuno-Ki/js13kgames-2016/"
               target="_blank">
                Fork me on GitHub
            </a>
        </p>
        <p>
            <a href="https://github.com/Ryuno-Ki/js13kgames-2016/blob/master/LICENSE.txt" target="_blank">
                License
            </a>
        </p>
        <p>
            Follow me on
            <a href="https://twitter.com/AndreJaenisch" target="_blank">
                Twitter
            </a>
        </p>
        <script>
(function(){var NotImplementedError,base,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;NotImplementedError=function(superClass){function NotImplementedError(){this.name="NotImplementedError",this.message="Not implemented yet",this.stack=(new Error).stack}return extend(NotImplementedError,superClass),NotImplementedError}(Error),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).errors&&(base.errors={}),root.game.errors.NotImplemented=NotImplementedError}).call(this);
//# sourceMappingURL=errors.min.js.map
(function(){var CarModel,CarView,base,base1,root;CarModel=function(){function CarModel(){return this._id=null,this._driving=!1,this}return CarModel.prototype.accelerate=function(){return this._driving=!0,this.isDriving()},CarModel.prototype.isDriving=function(){return this._driving},CarModel.prototype.stop=function(){return this._driving=!1,this.isDriving()},CarModel}(),CarView=function(){function CarView(){}return CarView.prototype.on=function(event,callback){callback()},CarView.prototype.handleEvent=function(event){switch(event.type){case"change":return this.change(event.target)}},CarView.prototype.change=function(target){},CarView.prototype.bindTo=function(element){return Object.defineProperty(this,"value",{enumerable:!0,get:function(){return element.value},set:function(val){return element.value=val}})},CarView.prototype.getTileContext=function(){var svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=document.createElementNS(svgns,"svg"),svgNode.setAttribute("viewBox","0 0 100 100"),svgNode.setAttribute("xmlns",svgns),svgNode.setAttribute("version","1.1"),svgNode.setAttribute("height","15"),svgNode.setAttribute("width","15"),svgNode},CarView.prototype.getTileContextNamespace=function(){return"http://www.w3.org/2000/svg"},CarView.prototype.render=function(){var bottomLeftWheel,bottomRightWheel,chassis,g,svgNode,svgns,topLeftWheel,topRightWheel;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),topLeftWheel=document.createElementNS(svgns,"rect"),topLeftWheel.setAttribute("x",10),topLeftWheel.setAttribute("y",10),topLeftWheel.setAttribute("height",20),topLeftWheel.setAttribute("width",10),topLeftWheel.setAttribute("class","wheel"),topRightWheel=document.createElementNS(svgns,"rect"),topRightWheel.setAttribute("x",80),topRightWheel.setAttribute("y",10),topRightWheel.setAttribute("height",20),topRightWheel.setAttribute("width",10),topRightWheel.setAttribute("class","wheel"),bottomLeftWheel=document.createElementNS(svgns,"rect"),bottomLeftWheel.setAttribute("x",10),bottomLeftWheel.setAttribute("y",70),bottomLeftWheel.setAttribute("height",20),bottomLeftWheel.setAttribute("width",10),bottomLeftWheel.setAttribute("class","wheel"),bottomRightWheel=document.createElementNS(svgns,"rect"),bottomRightWheel.setAttribute("x",80),bottomRightWheel.setAttribute("y",70),bottomRightWheel.setAttribute("height",20),bottomRightWheel.setAttribute("width",10),bottomRightWheel.setAttribute("class","wheel"),chassis=document.createElementNS(svgns,"rect"),chassis.setAttribute("x",20),chassis.setAttribute("y",5),chassis.setAttribute("height",90),chassis.setAttribute("width",60),chassis.setAttribute("class","chassis"),g.appendChild(topLeftWheel),g.appendChild(topRightWheel),g.appendChild(bottomLeftWheel),g.appendChild(bottomRightWheel),g.appendChild(chassis),svgNode.appendChild(g),svgNode.setAttribute("class","car"),svgNode},CarView}(),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).models&&(base.models={}),root.game.models.Car=CarModel,null==(base1=root.game).views&&(base1.views={}),root.game.views.Car=CarView}).call(this);
//# sourceMappingURL=car.min.js.map
(function(){var AbstractSvgView,base,root;AbstractSvgView=function(){function AbstractSvgView(){}return AbstractSvgView.prototype.getTileContext=function(){var svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=document.createElementNS(svgns,"svg"),svgNode.setAttribute("viewBox","0 0 100 100"),svgNode.setAttribute("xmlns",svgns),svgNode.setAttribute("version","1.1"),svgNode},AbstractSvgView.prototype.getTileContextNamespace=function(){return"http://www.w3.org/2000/svg"},AbstractSvgView}(),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).views&&(base.views={}),root.game.views.AbstractSvg=AbstractSvgView}).call(this);
//# sourceMappingURL=svg.min.js.map
(function(){var AbstractStreetView,AbstractSvgView,HorizontalStreetView,NotImplementedError,StreetModel,VerticalStreetView,base,base1,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;NotImplementedError||(NotImplementedError=this.game.errors.NotImplemented),AbstractSvgView||(AbstractSvgView=this.game.views.AbstractSvg),StreetModel=function(){function StreetModel(){return this.utilisation=0,this}return StreetModel.prototype.getUtilisation=function(){return this.utilisation},StreetModel}(),AbstractStreetView=function(superClass){function AbstractStreetView(){AbstractStreetView.__super__.constructor.call(this),this.cars=[]}return extend(AbstractStreetView,superClass),AbstractStreetView.prototype.render=function(){throw new NotImplementedError},AbstractStreetView.prototype.getCarsOnIt=function(){return this.cars.length},AbstractStreetView.prototype.enter=function(vehicle){var event;this.cars.push(vehicle),event=new global.window.CustomEvent("car-leaving"),global.document.dispatchEvent(event)},AbstractStreetView}(AbstractSvgView),HorizontalStreetView=function(superClass){function HorizontalStreetView(){return HorizontalStreetView.__super__.constructor.call(this),this.cars=[],this}return extend(HorizontalStreetView,superClass),HorizontalStreetView.prototype.render=function(){var g,leftBoundary,middleBoundary,rightBoundary,svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),leftBoundary=document.createElementNS(svgns,"path"),leftBoundary.setAttribute("d","M0 33H100"),middleBoundary=document.createElementNS(svgns,"path"),middleBoundary.setAttribute("d","M0 50H100"),rightBoundary=document.createElementNS(svgns,"path"),rightBoundary.setAttribute("d","M0 67H100"),g.appendChild(leftBoundary),g.appendChild(middleBoundary),g.appendChild(rightBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","horizontal street"),svgNode},HorizontalStreetView}(AbstractStreetView),VerticalStreetView=function(superClass){function VerticalStreetView(){return VerticalStreetView.__super__.constructor.call(this),this.cars=[],this}return extend(VerticalStreetView,superClass),VerticalStreetView.prototype.render=function(){var bottomBoundary,g,middleBoundary,svgNode,svgns,topBoundary;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),topBoundary=document.createElementNS(svgns,"path"),topBoundary.setAttribute("d","M33 0v100"),middleBoundary=document.createElementNS(svgns,"path"),middleBoundary.setAttribute("d","M50 0v100"),bottomBoundary=document.createElementNS(svgns,"path"),bottomBoundary.setAttribute("d","M67 0v100"),g.appendChild(topBoundary),g.appendChild(middleBoundary),g.appendChild(bottomBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","vertical street"),svgNode},VerticalStreetView}(AbstractStreetView),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).models&&(base.models={}),root.game.models.Street=StreetModel,null==(base1=root.game).views&&(base1.views={}),root.game.views.AbstractStreet=AbstractStreetView,root.game.views.HorizontalStreet=HorizontalStreetView,root.game.views.VerticalStreet=VerticalStreetView}).call(this);
//# sourceMappingURL=street.min.js.map
(function(){var AbstractStreetView,CrossroadModel,CrossroadView,StreetModel,base,base1,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;StreetModel||(StreetModel=this.game.models.Street),AbstractStreetView||(AbstractStreetView=this.game.views.AbstractStreet),CrossroadModel=function(superClass){function CrossroadModel(){return CrossroadModel.__super__.constructor.apply(this,arguments)}return extend(CrossroadModel,superClass),CrossroadModel.prototype.getUtilisation=function(){return 0},CrossroadModel}(StreetModel),CrossroadView=function(superClass){function CrossroadView(){CrossroadView.__super__.constructor.call(this),this.cars=[]}return extend(CrossroadView,superClass),CrossroadView.prototype.render=function(){var g,leftBottomBoundary,leftRightCrossline,leftTopBoundary,rightBottomBoundary,rightTopBoundary,svgNode,svgns,topBottomCrossline;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),leftTopBoundary=document.createElementNS(svgns,"path"),leftTopBoundary.setAttribute("d","M0 33h33v-33"),leftBottomBoundary=document.createElementNS(svgns,"path"),leftBottomBoundary.setAttribute("d","M67 0v33h33"),rightTopBoundary=document.createElementNS(svgns,"path"),rightTopBoundary.setAttribute("d","M0 67h33v33"),rightBottomBoundary=document.createElementNS(svgns,"path"),rightBottomBoundary.setAttribute("d","M100 67h-33v33"),leftRightCrossline=document.createElementNS(svgns,"path"),leftRightCrossline.setAttribute("d","M5 50 h90"),topBottomCrossline=document.createElementNS(svgns,"path"),topBottomCrossline.setAttribute("d","M50 5 v90"),g.appendChild(leftTopBoundary),g.appendChild(leftBottomBoundary),g.appendChild(rightTopBoundary),g.appendChild(rightBottomBoundary),g.appendChild(leftRightCrossline),g.appendChild(topBottomCrossline),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","crossroad street"),svgNode},CrossroadView}(AbstractStreetView),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).models&&(base.models={}),root.game.models.Crossroad=CrossroadModel,null==(base1=root.game).views&&(base1.views={}),root.game.views.Crossroad=CrossroadView}).call(this);
//# sourceMappingURL=crossroad.min.js.map
(function(){var AbstractSvgView,TrafficLightModel,TrafficLightView,base,base1,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;AbstractSvgView||(AbstractSvgView=this.game.views.AbstractSvg),TrafficLightModel=function(){function TrafficLightModel(){this._states=["red","yellow","green"],this._currentState=this._states[0],this._redToGreen=!0}return TrafficLightModel.prototype.getStates=function(){return this._states.slice(0)},TrafficLightModel.prototype.getState=function(){return this._currentState},TrafficLightModel.prototype.cycle=function(){var current,currentPosition,green,red,ref,states,yellow;return states=this._states,current=this._currentState,ref=this._states,red=ref[0],yellow=ref[1],green=ref[2],currentPosition=states.indexOf(current),this._redToGreen?current===red?this._currentState=states[1]:current===yellow?this._currentState=states[2]:(this._redToGreen=!1,this._currentState=states[1]):current===green?this._currentState=states[1]:current===yellow?this._currentState=states[0]:(this._redToGreen=!0,this._currentState=states[1]),this._currentState},TrafficLightModel}(),TrafficLightView=function(superClass){function TrafficLightView(){TrafficLightView.__super__.constructor.call(this)}return extend(TrafficLightView,superClass),TrafficLightView.prototype.render=function(){var device,g,greenLight,redLight,svgNode,svgns,yellowLight;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),device=document.createElementNS(svgns,"path"),device.setAttribute("d","M33 0h33v60h-11v40h-11v-40h-11z"),device.setAttribute("class","device"),redLight=document.createElementNS(svgns,"circle"),redLight.setAttribute("r","10"),redLight.setAttribute("cx","50"),redLight.setAttribute("cy","10"),redLight.setAttribute("class","red light"),yellowLight=document.createElementNS(svgns,"circle"),yellowLight.setAttribute("r","10"),yellowLight.setAttribute("cx","50"),yellowLight.setAttribute("cy","30"),yellowLight.setAttribute("class","yellow light"),greenLight=document.createElementNS(svgns,"circle"),greenLight.setAttribute("r","10"),greenLight.setAttribute("cx","50"),greenLight.setAttribute("cy","50"),greenLight.setAttribute("class","green light"),g.appendChild(redLight),g.appendChild(yellowLight),g.appendChild(greenLight),svgNode.appendChild(g),svgNode.setAttribute("height","40"),svgNode.setAttribute("width","40"),svgNode.setAttribute("class","traffic-light"),svgNode},TrafficLightView}(AbstractSvgView),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).models&&(base.models={}),root.game.models.TrafficLight=TrafficLightModel,null==(base1=root.game).views&&(base1.views={}),root.game.views.TrafficLight=TrafficLightView}).call(this);
//# sourceMappingURL=trafficLight.min.js.map
(function(){var AbstractCurveView,AbstractStreetView,LeftBottomCurveView,LeftTopCurveView,RightBottomCurveView,RightTopCurveView,base,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;AbstractStreetView||(AbstractStreetView=this.game.views.AbstractStreet),AbstractCurveView=function(superClass){function AbstractCurveView(){AbstractCurveView.__super__.constructor.call(this)}return extend(AbstractCurveView,superClass),AbstractCurveView}(AbstractStreetView),LeftTopCurveView=function(superClass){function LeftTopCurveView(){LeftTopCurveView.__super__.constructor.call(this),this.cars=[]}return extend(LeftTopCurveView,superClass),LeftTopCurveView.prototype.render=function(){var g,leftTopBoundary,rightBottomBoundary,svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),leftTopBoundary=document.createElementNS(svgns,"path"),leftTopBoundary.setAttribute("d","M0 33h33v-33"),rightBottomBoundary=document.createElementNS(svgns,"path"),rightBottomBoundary.setAttribute("d","M0 67h67v-67"),g.appendChild(leftTopBoundary),g.appendChild(rightBottomBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","left-top curve street"),svgNode},LeftTopCurveView}(AbstractCurveView),RightTopCurveView=function(superClass){function RightTopCurveView(){this.cars=[]}return extend(RightTopCurveView,superClass),RightTopCurveView.prototype.render=function(){var g,leftBottomBoundary,rightTopBoundary,svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),rightTopBoundary=document.createElementNS(svgns,"path"),rightTopBoundary.setAttribute("d","M100 33h-33v-33"),leftBottomBoundary=document.createElementNS(svgns,"path"),leftBottomBoundary.setAttribute("d","M100 67h-67v-67"),g.appendChild(rightTopBoundary),g.appendChild(leftBottomBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","right-top curve street"),svgNode},RightTopCurveView}(AbstractCurveView),LeftBottomCurveView=function(superClass){function LeftBottomCurveView(){this.cars=[]}return extend(LeftBottomCurveView,superClass),LeftBottomCurveView.prototype.render=function(){var g,leftTopBoundary,rightBottomBoundary,svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),leftTopBoundary=document.createElementNS(svgns,"path"),leftTopBoundary.setAttribute("d","M0 33h67v67"),rightBottomBoundary=document.createElementNS(svgns,"path"),rightBottomBoundary.setAttribute("d","M0 67h33v33"),g.appendChild(leftTopBoundary),g.appendChild(rightBottomBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","left-bottom curve street"),svgNode},LeftBottomCurveView}(AbstractCurveView),RightBottomCurveView=function(superClass){function RightBottomCurveView(){this.cars=[]}return extend(RightBottomCurveView,superClass),RightBottomCurveView.prototype.render=function(){var g,leftBottomBoundary,rightTopBoundary,svgNode,svgns;return svgns=this.getTileContextNamespace(),svgNode=this.getTileContext(),g=document.createElementNS(svgns,"g"),rightTopBoundary=document.createElementNS(svgns,"path"),rightTopBoundary.setAttribute("d","M100 33h-67v67"),leftBottomBoundary=document.createElementNS(svgns,"path"),leftBottomBoundary.setAttribute("d","M100 67h-33v67"),g.appendChild(rightTopBoundary),g.appendChild(leftBottomBoundary),svgNode.appendChild(g),svgNode.setAttribute("height","60"),svgNode.setAttribute("width","60"),svgNode.setAttribute("class","right-bottom curve street"),svgNode},RightBottomCurveView}(AbstractCurveView),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).views&&(base.views={}),root.game.views.AbstractCurve=AbstractCurveView,root.game.views.LeftTopCurve=LeftTopCurveView,root.game.views.RightTopCurve=RightTopCurveView,root.game.views.LeftBottomCurve=LeftBottomCurveView,root.game.views.RightBottomCurve=RightBottomCurveView}).call(this);
//# sourceMappingURL=curve.min.js.map
(function(){var CarView,CrossroadView,HorizontalStreetView,LeftBottomCurveView,LeftTopCurveView,MapModel,MapView,RightBottomCurveView,RightTopCurveView,TrafficLightView,VerticalStreetView,base,base1,root,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};LeftTopCurveView||(LeftTopCurveView=this.game.views.LeftTopCurve),CrossroadView||(RightTopCurveView=this.game.views.RightTopCurve),LeftBottomCurveView||(LeftBottomCurveView=this.game.views.LeftBottomCurve),RightBottomCurveView||(RightBottomCurveView=this.game.views.RightBottomCurve),HorizontalStreetView||(HorizontalStreetView=this.game.views.HorizontalStreet),VerticalStreetView||(VerticalStreetView=this.game.views.VerticalStreet),CrossroadView||(CrossroadView=this.game.views.Crossroad),TrafficLightView||(TrafficLightView=this.game.views.TrafficLight),CarView||(CarView=this.game.views.Car),MapModel=function(){function MapModel(canvasHeight,canvasWidth){this.canvasHeight=canvasHeight||300,this.canvasWidth=canvasWidth||300,this.tileHeight=60,this.tileWidth=60,MapModel.SIGNS={LEFT_TOP:"^",RIGHT_TOP:">",RIGHT_BOTTOM:"v",LEFT_BOTTOM:"<",HORIZONTAL:"-",VERTICAL:"|",CROSSROAD:"+",ANY:"?"}}return MapModel.prototype.getCanvasHeight=function(){return this.canvasHeight},MapModel.prototype.getCanvasWidth=function(){return this.canvasWidth},MapModel.prototype.calculateMap=function(){var col,i,j,map,numCols,numRows,ref,ref1,row;for(map=this._initMap(),numRows=map.numRows,numCols=map.numCols,row=i=0,ref=numRows;0<=ref?i<ref:i>ref;row=0<=ref?++i:--i)for(col=j=0,ref1=numCols;0<=ref1?j<ref1:j>ref1;col=0<=ref1?++j:--j)this._setTile([row,col],map);return JSON.stringify({map:map,numRows:map.numRows,numCols:map.numCols})},MapModel.prototype._initMap=function(){var col,i,j,map,numCols,numRows,ref,ref1,row;for(numRows=Math.floor(this.canvasHeight/this.tileHeight),numCols=Math.floor(this.canvasWidth/this.tileWidth),map=[],map.numRows=numRows,map.numCols=numCols,row=i=0,ref=numRows;0<=ref?i<ref:i>ref;row=0<=ref?++i:--i)for(map[row]=[],col=j=0,ref1=numCols;0<=ref1?j<ref1:j>ref1;col=0<=ref1?++j:--j)map[row][col]=MapModel.SIGNS.ANY;return map},MapModel.prototype._setTile=function(position,map){var col,environment,numCols,numRows,row;return row=position[0],col=position[1],numRows=map.numRows-1,numCols=map.numCols-1,environment={above:row>0?map[row-1][col]:null,below:row<numRows?map[row+1][col]:null,leftHand:col>0?map[row][col-1]:null,rightHand:col<numCols?map[row][col+1]:null},map[row][col]=this.pickTile(environment),map},MapModel.prototype.pickTile=function(environment){var candidates,ref,s,tileSet;return candidates=this.filterTileCandidates(environment),tileSet=function(){var i,len,results;for(results=[],i=0,len=candidates.length;i<len;i++)s=candidates[i],s!==MapModel.SIGNS.ANY&&results.push(s);return results}(),ref=MapModel.SIGNS.ANY,indexOf.call(candidates,ref)>=0?candidates=tileSet[Math.floor(Math.random()*tileSet.length)]:candidates.length>1&&(candidates=candidates[Math.floor(Math.random()*candidates.length)]),candidates[0]},MapModel.prototype.filterTileCandidates=function(environment){var allowedNeighborhood,candidates,envList,k,notAccessibleFrom,numOfNulls,ref,ref1,ref2,ref3,v;return allowedNeighborhood={above:[MapModel.SIGNS.LEFT_TOP,MapModel.SIGNS.RIGHT_TOP,MapModel.SIGNS.VERTICAL,MapModel.SIGNS.CROSSROAD,MapModel.SIGNS.ANY],below:[MapModel.SIGNS.LEFT_BOTTOM,MapModel.SIGNS.RIGHT_BOTTOM,MapModel.SIGNS.VERTICAL,MapModel.SIGNS.CROSSROAD,MapModel.SIGNS.ANY],leftHand:[MapModel.SIGNS.LEFT_TOP,MapModel.SIGNS.LEFT_BOTTOM,MapModel.SIGNS.HORIZONTAL,MapModel.SIGNS.CROSSROAD,MapModel.SIGNS.ANY],rightHand:[MapModel.SIGNS.RIGHT_TOP,MapModel.SIGNS.RIGHT_BOTTOM,MapModel.SIGNS.HORIZONTAL,MapModel.SIGNS.CROSSROAD,MapModel.SIGNS.ANY]},notAccessibleFrom={top:[MapModel.SIGNS.LEFT_BOTTOM,MapModel.SIGNS.RIGHT_BOTTOM,MapModel.SIGNS.HORIZONTAL],bottom:[MapModel.SIGNS.LEFT_TOP,MapModel.SIGNS.RIGHT_TOP,MapModel.SIGNS.HORIZONTAL],left:[MapModel.SIGNS.RIGHT_TOP,MapModel.SIGNS.RIGHT_BOTTOM,MapModel.SIGNS.VERTICAL],right:[MapModel.SIGNS.LEFT_TOP,MapModel.SIGNS.LEFT_BOTTOM,MapModel.SIGNS.VERTICAL]},candidates=function(){var ref,results;ref=MapModel.SIGNS,results=[];for(k in ref)v=ref[k],results.push(v);return results}(),envList=function(){var results;results=[];for(k in environment)v=environment[k],results.push(v);return results}(),numOfNulls=envList.reduce(function(sum,item){return sum+(null===item)},0),2===numOfNulls?(null===environment.above&&(candidates=candidates.filter(function(tile){return indexOf.call(allowedNeighborhood.above,tile)<0})),null===environment.rightHand&&(candidates=candidates.filter(function(tile){return indexOf.call(allowedNeighborhood.rightHand,tile)<0})),null===environment.leftHand&&(candidates=candidates.filter(function(tile){return indexOf.call(allowedNeighborhood.leftHand,tile)<0})),null===environment.below&&(candidates=candidates.filter(function(tile){return indexOf.call(allowedNeighborhood.below,tile)<0}))):1===numOfNulls?(null===environment.above&&(candidates=notAccessibleFrom.top),null===environment.rightHand&&(candidates=notAccessibleFrom.right),null===environment.leftHand&&(candidates=notAccessibleFrom.left),null===environment.below&&(candidates=notAccessibleFrom.bottom)):(ref=environment.above,indexOf.call(notAccessibleFrom.bottom,ref)>=0?(ref1=environment.leftHand,candidates=indexOf.call(notAccessibleFrom.right,ref1)>=0?[MapModel.SIGNS.RIGHT_BOTTOM]:[MapModel.SIGNS.LEFT_BOTTOM,MapModel.SIGNS.HORIZONTAL]):(ref2=environment.leftHand,indexOf.call(notAccessibleFrom.right,ref2)>=0?(ref3=environment.above,candidates=indexOf.call(notAccessibleFrom.bottom,ref3)>=0?[MapModel.SIGNS.RIGHT_BOTTOM]:[MapModel.SIGNS.RIGHT_TOP,MapModel.SIGNS.VERTICAL]):candidates=[MapModel.SIGNS.LEFT_TOP,MapModel.SIGNS.CROSSROAD])),candidates},MapModel}(),MapView=function(){function MapView(node){this.node=node}return MapView.prototype.render=function(mapData){var col,i,j,ref,ref1,row,sign,tile;for(console.log("Translating into DOM:"),console.log(mapData.map),row=i=0,ref=mapData.numRows;0<=ref?i<ref:i>ref;row=0<=ref?++i:--i)for(col=j=0,ref1=mapData.numCols;0<=ref1?j<ref1:j>ref1;col=0<=ref1?++j:--j)sign=mapData.map[row][col],null!==sign&&(tile=this.addTrafficLight(this.getTileForSign(sign)),this.node.appendChild(tile))},MapView.prototype.getTileForSign=function(sign){var view;switch(sign){case MapModel.SIGNS.LEFT_TOP:view=LeftTopCurveView;break;case MapModel.SIGNS.RIGHT_TOP:view=RightTopCurveView;break;case MapModel.SIGNS.RIGHT_BOTTOM:view=RightBottomCurveView;break;case MapModel.SIGNS.LEFT_BOTTOM:view=LeftBottomCurveView;break;case MapModel.SIGNS.HORIZONTAL:view=HorizontalStreetView;break;case MapModel.SIGNS.VERTICAL:view=VerticalStreetView;break;case MapModel.SIGNS.CROSSROAD:view=CrossroadView}return(new view).render()},MapView.prototype.addTrafficLight=function(tile){var trafficLight;return/crossroad/.test(tile.getAttribute("class"))?(trafficLight=(new TrafficLightView).render(),tile.appendChild(trafficLight),trafficLight=(new TrafficLightView).render(),tile.appendChild(trafficLight),trafficLight=(new TrafficLightView).render(),tile.appendChild(trafficLight),trafficLight=(new TrafficLightView).render(),tile.appendChild(trafficLight),tile):tile},MapView.prototype.spawnCar=function(mapData){var indexOfTile,numTiles,tileWithNewCar;return numTiles=mapData.numRows*mapData.numCols,indexOfTile=Math.floor(Math.random()*numTiles),tileWithNewCar=this.node.children.item(indexOfTile),tileWithNewCar.appendChild((new CarView).render()),tileWithNewCar},MapView}(),root="undefined"!=typeof exports&&null!==exports?exports:this,null==root.game&&(root.game={}),null==(base=root.game).models&&(base.models={}),root.game.models.Map=MapModel,null==(base1=root.game).views&&(base1.views={}),root.game.views.Map=MapView}).call(this);
//# sourceMappingURL=map.min.js.map
(function(){var mapData,mapModel,mapView,node;node=document.getElementById("map"),mapModel=new game.models.Map(300,360),mapView=new game.views.Map(node),mapData=JSON.parse(mapModel.calculateMap()),mapView.render(mapData),setInterval(function(){return mapView.spawnCar(mapData)},1e3)}).call(this);
//# sourceMappingURL=app.min.js.map        </script>
    </body>
</html>
