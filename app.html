<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Glitch - js13kgames 2016</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <style>
body {
    background: burlywood;
    overflow: hidden;
}

#fork-on-github {
    position: absolute;
    right: 0;
    top: 0;
    transform-origin: center center 0px;
    transform: rotate(45deg) translate(0, 1em);
}

#fork-on-github a {
    background: black;
    color: white;
    display: inline-block;
    text-align: center;
    text-decoration: none;
    width: 150%;
}

#map {
    background: white;
    margin: 0 auto;
    max-width: 360px;
}

#map::after {
    clear: both;
    content: " ";
    display: block;
}

svg {
    box-sizing: border-box;
    /* https://css-tricks.com/fighting-the-space-between-inline-block-elements/ */
    display: block;
    float: left;
}

.street .car .chassis {
    fill: black;
    stroke: black;
}

.horizontal.street .car {
    transform: rotate(90deg) translate(50%, 80%);
}

.vertical.street .car {
    transform: translate(50%, 80%);
}

.left-top.curve .car,
.crossroad .car {
    animation-name: topToLeftDrive;
    transform: rotate(90deg) translate(33%, 80%);
}

.right-top.curve .car {
    animation-name: topToRightDrive;
    transform: rotate(-90deg) translate(33%, 85%);
}

.right-bottom.curve .car {
    animation-name: rightToBottomDrive;
    transform: translate(33%, 85%);
}


.left-bottom.curve .car {
    animation-name: bottomToLeftDrive;
    transform: rotate(90deg) translate(33%, 80%);
}

.horizontal.street .car {
    animation-name: horizontalDrive;
}

.vertical.street .car {
    animation-name: verticalDrive;
}

.street .car {
    animation-duration: 1s;
    transform-origin: center;
}

@keyframes topToLeftDrive {
    0% {
        transform: translate(33%, 0%);
    }
    
    40% {
        transform: translate(33%, 40%);
    }

    60% {
        transform: rotate(90deg) translate(33%, 60%);
    }

    100% {
        transform: rotate(90deg) translate(33%, 80%);
    }
}

@keyframes topToRightDrive {
    0% {
        transform: translate(33%, 0%);
    }
    
    40% {
        transform: translate(33%, 33%);
    }

    60% {
        transform: rotate(-90deg) translate(33%, 40%);
    }

    100% {
        transform: rotate(-90deg) translate(33%, 85%);
    }
}

@keyframes rightToBottomDrive {
    0% {
        transform: rotate(-90deg) translate(50%, 85%);
    }

    40% {
        transform: rotate(-90deg) translate(50%, 50%);
    }

    60% {
        transform: translate(33%, 60%);
    }
    
    100% {
        transform: translate(33%, 85%);
    }
}

@keyframes bottomToLeftDrive {
    0% {
        transform: translate(50%, 85%);
    }

    40% {
        transform: translate(50%, 60%);
    }

    60% {
        transform: rotate(90deg) translate(33%, 60%);
    }

    100% {
        transform: rotate(90deg) translate(33%, 80%);
    }
}

@keyframes horizontalDrive {
    0% {
        transform: rotate(90deg) translate(50%, 0%);
    }

    100% {
        transform: rotate(90deg) translate(50%, 80%);
    }
}

@keyframes verticalDrive {
    0% {
        transform: translate(50%, 0%);
    }

    100% {
        transform: translate(50%, 80%);
    }
}

svg path {
    fill: white;
    stroke: black;
}

svg path {
    stroke-width: 1;
}

.traffic-light .current.red {
    fill: red;
}

.traffic-light .current.yellow {
    fill: yellow;
}

.traffic-light .current.green {
    fill: green;
}

.crossroad .traffic-light:first-of-type {
    transform: translate(4em, 4.5em);
}

/* aka :second-of-type */
.crossroad .traffic-light:first-of-type + .traffic-light {
    transform: rotate(90deg) translate(4em, 4.5em);
    transform-origin: center;
}

/* aka :third-of-type */
.crossroad .traffic-light:first-of-type + .traffic-light + .traffic-light {
    transform: rotate(90deg);
    transform-origin: center;
}
        </style>
        <meta name="description"
              content="Ryuno-Ki's contribution to js13kgames of 2016" />
    </head>
    <body>
        <div id="map"></div>
        <p id="fork-on-github">
            <a href="https://github.com/Ryuno-Ki/js13kgames-2016/"
               target="_blank">
                Fork me on GitHub
            </a>
        </p>
        <p>
            <a href="https://github.com/Ryuno-Ki/js13kgames-2016/blob/master/LICENSE.txt" target="_blank">
                License
            </a>
        </p>
        <p>
            Follow me on
            <a href="https://twitter.com/AndreJaenisch" target="_blank">
                Twitter
            </a>
        </p>
        <script>
(function(){var a,b,c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;a=function(a){function b(){this.name="NotImplementedError",this.message="Not implemented yet",this.stack=(new Error).stack}return d(b,a),b}(Error),c="undefined"!=typeof exports&&null!==exports?exports:this,null==c.game&&(c.game={}),null==(b=c.game).errors&&(b.errors={}),c.game.errors.NotImplemented=a}).call(this);
//# sourceMappingURL=errors.min.js.map
(function(){var a,b,c,d,e;a=function(){function a(){return this._id=null,this._driving=!1,this}return a.prototype.accelerate=function(){return this._driving=!0,this.isDriving()},a.prototype.isDriving=function(){return this._driving},a.prototype.stop=function(){return this._driving=!1,this.isDriving()},a}(),b=function(){function a(){}return a.prototype.on=function(a,b){b()},a.prototype.handleEvent=function(a){switch(a.type){case"change":return this.change(a.target)}},a.prototype.change=function(a){},a.prototype.bindTo=function(a){return Object.defineProperty(this,"value",{enumerable:!0,get:function(){return a.value},set:function(b){return a.value=b}})},a.prototype.getTileContext=function(){var a,b;return b=this.getTileContextNamespace(),a=document.createElementNS(b,"svg"),a.setAttribute("viewBox","0 0 100 100"),a.setAttribute("xmlns",b),a.setAttribute("version","1.1"),a.setAttribute("height","15"),a.setAttribute("width","15"),a},a.prototype.getTileContextNamespace=function(){return"http://www.w3.org/2000/svg"},a.prototype.render=function(){var a,b,c,d,e,f,g,h;return f=this.getTileContextNamespace(),e=this.getTileContext(),d=document.createElementNS(f,"g"),g=document.createElementNS(f,"rect"),g.setAttribute("x",10),g.setAttribute("y",10),g.setAttribute("height",20),g.setAttribute("width",10),g.setAttribute("class","wheel"),h=document.createElementNS(f,"rect"),h.setAttribute("x",80),h.setAttribute("y",10),h.setAttribute("height",20),h.setAttribute("width",10),h.setAttribute("class","wheel"),a=document.createElementNS(f,"rect"),a.setAttribute("x",10),a.setAttribute("y",70),a.setAttribute("height",20),a.setAttribute("width",10),a.setAttribute("class","wheel"),b=document.createElementNS(f,"rect"),b.setAttribute("x",80),b.setAttribute("y",70),b.setAttribute("height",20),b.setAttribute("width",10),b.setAttribute("class","wheel"),c=document.createElementNS(f,"rect"),c.setAttribute("x",20),c.setAttribute("y",5),c.setAttribute("height",90),c.setAttribute("width",60),c.setAttribute("class","chassis"),d.appendChild(g),d.appendChild(h),d.appendChild(a),d.appendChild(b),d.appendChild(c),e.appendChild(d),e.setAttribute("class","car"),e},a}(),e="undefined"!=typeof exports&&null!==exports?exports:this,null==e.game&&(e.game={}),null==(c=e.game).models&&(c.models={}),e.game.models.Car=a,null==(d=e.game).views&&(d.views={}),e.game.views.Car=b}).call(this);
//# sourceMappingURL=car.min.js.map
(function(){var a,b,c;a=function(){function a(){}return a.prototype.getTileContext=function(){var a,b;return b=this.getTileContextNamespace(),a=document.createElementNS(b,"svg"),a.setAttribute("viewBox","0 0 100 100"),a.setAttribute("xmlns",b),a.setAttribute("version","1.1"),a},a.prototype.getTileContextNamespace=function(){return"http://www.w3.org/2000/svg"},a}(),c="undefined"!=typeof exports&&null!==exports?exports:this,null==c.game&&(c.game={}),null==(b=c.game).views&&(b.views={}),c.game.views.AbstractSvg=a}).call(this);
//# sourceMappingURL=svg.min.js.map
(function(){var a,b,c,d,e,f,g,h,i,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;d||(d=this.game.errors.NotImplemented),b||(b=this.game.views.AbstractSvg),e=function(){function a(){return this.utilisation=0,this}return a.prototype.getUtilisation=function(){return this.utilisation},a}(),a=function(a){function b(){b.__super__.constructor.call(this),this.cars=[]}return j(b,a),b.prototype.render=function(){throw new d},b.prototype.getCarsOnIt=function(){return this.cars.length},b.prototype.enter=function(a){var b;this.cars.push(a),b=new global.window.CustomEvent("car-leaving"),global.document.dispatchEvent(b)},b}(b),c=function(a){function b(){return b.__super__.constructor.call(this),this.cars=[],this}return j(b,a),b.prototype.render=function(){var a,b,c,d,e,f;return f=this.getTileContextNamespace(),e=this.getTileContext(),a=document.createElementNS(f,"g"),b=document.createElementNS(f,"path"),b.setAttribute("d","M0 33H100"),c=document.createElementNS(f,"path"),c.setAttribute("d","M0 50H100"),d=document.createElementNS(f,"path"),d.setAttribute("d","M0 67H100"),a.appendChild(b),a.appendChild(c),a.appendChild(d),e.appendChild(a),e.setAttribute("height","60"),e.setAttribute("width","60"),e.setAttribute("class","horizontal street"),e},b}(a),f=function(a){function b(){return b.__super__.constructor.call(this),this.cars=[],this}return j(b,a),b.prototype.render=function(){var a,b,c,d,e,f;return e=this.getTileContextNamespace(),d=this.getTileContext(),b=document.createElementNS(e,"g"),f=document.createElementNS(e,"path"),f.setAttribute("d","M33 0v100"),c=document.createElementNS(e,"path"),c.setAttribute("d","M50 0v100"),a=document.createElementNS(e,"path"),a.setAttribute("d","M67 0v100"),b.appendChild(f),b.appendChild(c),b.appendChild(a),d.appendChild(b),d.setAttribute("height","60"),d.setAttribute("width","60"),d.setAttribute("class","vertical street"),d},b}(a),i="undefined"!=typeof exports&&null!==exports?exports:this,null==i.game&&(i.game={}),null==(g=i.game).models&&(g.models={}),i.game.models.Street=e,null==(h=i.game).views&&(h.views={}),i.game.views.AbstractStreet=a,i.game.views.HorizontalStreet=c,i.game.views.VerticalStreet=f}).call(this);
//# sourceMappingURL=street.min.js.map
(function(){var a,b,c,d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;d||(d=this.game.models.Street),a||(a=this.game.views.AbstractStreet),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.getUtilisation=function(){return 0},b}(d),c=function(a){function b(){b.__super__.constructor.call(this),this.cars=[]}return h(b,a),b.prototype.render=function(){var a,b,c,d,e,f,g,h,i;return h=this.getTileContextNamespace(),g=this.getTileContext(),a=document.createElementNS(h,"g"),d=document.createElementNS(h,"path"),d.setAttribute("d","M0 33h33v-33"),b=document.createElementNS(h,"path"),b.setAttribute("d","M67 0v33h33"),f=document.createElementNS(h,"path"),f.setAttribute("d","M0 67h33v33"),e=document.createElementNS(h,"path"),e.setAttribute("d","M100 67h-33v33"),c=document.createElementNS(h,"path"),c.setAttribute("d","M5 50 h90"),i=document.createElementNS(h,"path"),i.setAttribute("d","M50 5 v90"),a.appendChild(d),a.appendChild(b),a.appendChild(f),a.appendChild(e),a.appendChild(c),a.appendChild(i),g.appendChild(a),g.setAttribute("height","60"),g.setAttribute("width","60"),g.setAttribute("class","crossroad street"),g},b}(a),g="undefined"!=typeof exports&&null!==exports?exports:this,null==g.game&&(g.game={}),null==(e=g.game).models&&(e.models={}),g.game.models.Crossroad=b,null==(f=g.game).views&&(f.views={}),g.game.views.Crossroad=c}).call(this);
//# sourceMappingURL=crossroad.min.js.map
(function(){var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;a||(a=this.game.views.AbstractSvg),b=function(){function a(){this._states=["red","yellow","green"],this._currentState=this._states[0],this._redToGreen=!0}return a.prototype.getStates=function(){return this._states.slice(0)},a.prototype.getState=function(){return this._currentState},a.prototype.setState=function(a){this._currentState=this._states[this._states.indexOf(a)]},a.prototype.cycle=function(){var a,b,c,d,e,f,g;return f=this._states,a=this._currentState,e=this._states,d=e[0],g=e[1],c=e[2],b=f.indexOf(a),this._redToGreen?a===d?this._currentState=f[1]:a===g?this._currentState=f[2]:(this._redToGreen=!1,this._currentState=f[1]):a===c?this._currentState=f[1]:a===g?this._currentState=f[0]:(this._redToGreen=!0,this._currentState=f[1]),this._currentState},a}(),c=function(a){function b(){this.bindTo=g(this.bindTo,this),b.__super__.constructor.call(this),this.node=null,this.model=null,this.state="red"}return h(b,a),b.prototype.render=function(){var a,b,c,d,e,f,g;return f=this.getTileContextNamespace(),e=this.getTileContext(),b=document.createElementNS(f,"g"),a=document.createElementNS(f,"path"),a.setAttribute("d","M33 0h33v60h-11v40h-11v-40h-11z"),a.setAttribute("class","device"),d=document.createElementNS(f,"circle"),d.setAttribute("r","10"),d.setAttribute("cx","50"),d.setAttribute("cy","10"),d.setAttribute("class","current red light"),g=document.createElementNS(f,"circle"),g.setAttribute("r","10"),g.setAttribute("cx","50"),g.setAttribute("cy","30"),g.setAttribute("class","yellow light"),c=document.createElementNS(f,"circle"),c.setAttribute("r","10"),c.setAttribute("cx","50"),c.setAttribute("cy","50"),c.setAttribute("class","green light"),b.appendChild(d),b.appendChild(g),b.appendChild(c),e.appendChild(b),e.setAttribute("height","40"),e.setAttribute("width","40"),e.setAttribute("class","traffic-light"),this.node=e,this.on("click"),e},b.prototype.bindTo=function(a){return this.model=a,Object.defineProperty(this,"state",{enumerable:!0,get:function(){return a.getState()},set:function(b){var c,d;a.setState(b),c=this.node.querySelector(".current.light"),c.classList.remove("current"),d=this.node.querySelector("."+b),d.classList.add("current")}})},b.prototype.on=function(a,b){this.node.addEventListener(a,function(a){return function(c){switch(c.type){case"click":a.cycleState()}if(b)return b()}}(this))},b.prototype.cycleState=function(){return this.state=this.model.cycle()},b}(a),f="undefined"!=typeof exports&&null!==exports?exports:this,null==f.game&&(f.game={}),null==(d=f.game).models&&(d.models={}),f.game.models.TrafficLight=b,null==(e=f.game).views&&(e.views={}),f.game.views.TrafficLight=c}).call(this);
//# sourceMappingURL=trafficLight.min.js.map
(function(){var a,b,c,d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;b||(b=this.game.views.AbstractStreet),a=function(a){function b(){b.__super__.constructor.call(this)}return i(b,a),b}(b),d=function(a){function b(){b.__super__.constructor.call(this),this.cars=[]}return i(b,a),b.prototype.render=function(){var a,b,c,d,e;return e=this.getTileContextNamespace(),d=this.getTileContext(),a=document.createElementNS(e,"g"),b=document.createElementNS(e,"path"),b.setAttribute("d","M0 33h33v-33"),c=document.createElementNS(e,"path"),c.setAttribute("d","M0 67h67v-67"),a.appendChild(b),a.appendChild(c),d.appendChild(a),d.setAttribute("height","60"),d.setAttribute("width","60"),d.setAttribute("class","left-top curve street"),d},b}(a),f=function(a){function b(){this.cars=[]}return i(b,a),b.prototype.render=function(){var a,b,c,d,e;return e=this.getTileContextNamespace(),d=this.getTileContext(),a=document.createElementNS(e,"g"),c=document.createElementNS(e,"path"),c.setAttribute("d","M100 33h-33v-33"),b=document.createElementNS(e,"path"),b.setAttribute("d","M100 67h-67v-67"),a.appendChild(c),a.appendChild(b),d.appendChild(a),d.setAttribute("height","60"),d.setAttribute("width","60"),d.setAttribute("class","right-top curve street"),d},b}(a),c=function(a){function b(){this.cars=[]}return i(b,a),b.prototype.render=function(){var a,b,c,d,e;return e=this.getTileContextNamespace(),d=this.getTileContext(),a=document.createElementNS(e,"g"),b=document.createElementNS(e,"path"),b.setAttribute("d","M0 33h67v67"),c=document.createElementNS(e,"path"),c.setAttribute("d","M0 67h33v33"),a.appendChild(b),a.appendChild(c),d.appendChild(a),d.setAttribute("height","60"),d.setAttribute("width","60"),d.setAttribute("class","left-bottom curve street"),d},b}(a),e=function(a){function b(){this.cars=[]}return i(b,a),b.prototype.render=function(){var a,b,c,d,e;return e=this.getTileContextNamespace(),d=this.getTileContext(),a=document.createElementNS(e,"g"),c=document.createElementNS(e,"path"),c.setAttribute("d","M100 33h-67v67"),b=document.createElementNS(e,"path"),b.setAttribute("d","M100 67h-33v67"),a.appendChild(c),a.appendChild(b),d.appendChild(a),d.setAttribute("height","60"),d.setAttribute("width","60"),d.setAttribute("class","right-bottom curve street"),d},b}(a),h="undefined"!=typeof exports&&null!==exports?exports:this,null==h.game&&(h.game={}),null==(g=h.game).views&&(g.views={}),h.game.views.AbstractCurve=a,h.game.views.LeftTopCurve=d,h.game.views.RightTopCurve=f,h.game.views.LeftBottomCurve=c,h.game.views.RightBottomCurve=e}).call(this);
//# sourceMappingURL=curve.min.js.map
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};j||(j=this.game.models.TrafficLight),e||(e=this.game.views.LeftTopCurve),b||(i=this.game.views.RightTopCurve),d||(d=this.game.views.LeftBottomCurve),h||(h=this.game.views.RightBottomCurve),c||(c=this.game.views.HorizontalStreet),l||(l=this.game.views.VerticalStreet),b||(b=this.game.views.Crossroad),k||(k=this.game.views.TrafficLight),a||(a=this.game.views.Car),f=function(){function a(b,c){this.canvasHeight=b||300,this.canvasWidth=c||300,this.tileHeight=60,this.tileWidth=60,a.SIGNS={LEFT_TOP:"^",RIGHT_TOP:">",RIGHT_BOTTOM:"v",LEFT_BOTTOM:"<",HORIZONTAL:"-",VERTICAL:"|",CROSSROAD:"+",ANY:"?"}}return a.prototype.getCanvasHeight=function(){return this.canvasHeight},a.prototype.getCanvasWidth=function(){return this.canvasWidth},a.prototype.calculateMap=function(){var a,b,c,d,e,f,g,h,i;for(d=this._initMap(),f=d.numRows,e=d.numCols,i=b=0,g=f;0<=g?b<g:b>g;i=0<=g?++b:--b)for(a=c=0,h=e;0<=h?c<h:c>h;a=0<=h?++c:--c)this._setTile([i,a],d);return JSON.stringify({map:d,numRows:d.numRows,numCols:d.numCols})},a.prototype._initMap=function(){var b,c,d,e,f,g,h,i,j;for(g=Math.floor(this.canvasHeight/this.tileHeight),f=Math.floor(this.canvasWidth/this.tileWidth),e=[],e.numRows=g,e.numCols=f,j=c=0,h=g;0<=h?c<h:c>h;j=0<=h?++c:--c)for(e[j]=[],b=d=0,i=f;0<=i?d<i:d>i;b=0<=i?++d:--d)e[j][b]=a.SIGNS.ANY;return e},a.prototype._setTile=function(a,b){var c,d,e,f,g;return g=a[0],c=a[1],f=b.numRows-1,e=b.numCols-1,d={above:g>0?b[g-1][c]:null,below:g<f?b[g+1][c]:null,leftHand:c>0?b[g][c-1]:null,rightHand:c<e?b[g][c+1]:null},b[g][c]=this.pickTile(d),b},a.prototype.pickTile=function(b){var c,d,e,f;return c=this.filterTileCandidates(b),f=function(){var b,d,f;for(f=[],b=0,d=c.length;b<d;b++)e=c[b],e!==a.SIGNS.ANY&&f.push(e);return f}(),d=a.SIGNS.ANY,p.call(c,d)>=0?c=f[Math.floor(Math.random()*f.length)]:c.length>1&&(c=c[Math.floor(Math.random()*c.length)]),c[0]},a.prototype.filterTileCandidates=function(b){var c,d,e,f,g,h,i,j,k,l,m;return c={above:[a.SIGNS.LEFT_TOP,a.SIGNS.RIGHT_TOP,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],below:[a.SIGNS.LEFT_BOTTOM,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],leftHand:[a.SIGNS.LEFT_TOP,a.SIGNS.LEFT_BOTTOM,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],rightHand:[a.SIGNS.RIGHT_TOP,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY]},g={top:[a.SIGNS.LEFT_BOTTOM,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.HORIZONTAL],bottom:[a.SIGNS.LEFT_TOP,a.SIGNS.RIGHT_TOP,a.SIGNS.HORIZONTAL],left:[a.SIGNS.RIGHT_TOP,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.VERTICAL],right:[a.SIGNS.LEFT_TOP,a.SIGNS.LEFT_BOTTOM,a.SIGNS.VERTICAL]},d=function(){var b,c;b=a.SIGNS,c=[];for(f in b)m=b[f],c.push(m);return c}(),e=function(){var a;a=[];for(f in b)m=b[f],a.push(m);return a}(),h=e.reduce(function(a,b){return a+(null===b)},0),2===h?(null===b.above&&(d=d.filter(function(a){return p.call(c.above,a)<0})),null===b.rightHand&&(d=d.filter(function(a){return p.call(c.rightHand,a)<0})),null===b.leftHand&&(d=d.filter(function(a){return p.call(c.leftHand,a)<0})),null===b.below&&(d=d.filter(function(a){return p.call(c.below,a)<0}))):1===h?(null===b.above&&(d=g.top),null===b.rightHand&&(d=g.right),null===b.leftHand&&(d=g.left),null===b.below&&(d=g.bottom)):(i=b.above,p.call(g.bottom,i)>=0?(j=b.leftHand,d=p.call(g.right,j)>=0?[a.SIGNS.RIGHT_BOTTOM]:[a.SIGNS.LEFT_BOTTOM,a.SIGNS.HORIZONTAL]):(k=b.leftHand,p.call(g.right,k)>=0?(l=b.above,d=p.call(g.bottom,l)>=0?[a.SIGNS.RIGHT_BOTTOM]:[a.SIGNS.RIGHT_TOP,a.SIGNS.VERTICAL]):d=[a.SIGNS.LEFT_TOP,a.SIGNS.CROSSROAD])),d},a}(),g=function(){function g(a){this.node=a,this.mapData=null}return g.prototype.render=function(a){var b,c,d,e,f,g,h,i;for(g=c=0,e=a.numRows;0<=e?c<e:c>e;g=0<=e?++c:--c)for(b=d=0,f=a.numCols;0<=f?d<f:d>f;b=0<=f?++d:--d)h=a.map[g][b],i=this.addTrafficLight(this.getTileForSign(h)),this.node.appendChild(i);return this.mapData=a,this.on("animationend"),this.on("click"),this.node},g.prototype.getTileForSign=function(a){var g;switch(a){case f.SIGNS.LEFT_TOP:g=e;break;case f.SIGNS.RIGHT_TOP:g=i;break;case f.SIGNS.RIGHT_BOTTOM:g=h;break;case f.SIGNS.LEFT_BOTTOM:g=d;break;case f.SIGNS.HORIZONTAL:g=c;break;case f.SIGNS.VERTICAL:g=l;break;case f.SIGNS.CROSSROAD:g=b}return(new g).render()},g.prototype.addTrafficLight=function(a){var b,c,d;return/crossroad/.test(a.getAttribute("class"))?(b=new j,d=new k,c=d.render(),d.bindTo(b),a.appendChild(c),b=new j,d=new k,c=d.render(),d.bindTo(b),a.appendChild(c),b=new j,d=new k,c=d.render(),d.bindTo(b),a.appendChild(c),b=new j,d=new k,c=d.render(),d.bindTo(b),a.appendChild(c),a):a},g.prototype.on=function(a,b){this.node.addEventListener(a,function(a){return function(c){switch(c.type){case"click":a.spawnCar();break;case"animationend":a.moveCarToNextTile(c.target)}if(b)return b()}}(this))},g.prototype.spawnCar=function(){var b,c,d;return c=this.mapData.numRows*this.mapData.numCols,b=Math.floor(Math.random()*c),d=this.node.children.item(b),d.appendChild((new a).render()),d},g.prototype.moveCarToNextTile=function(a){var b,c;b=a.parentNode,c=b.previousSibling,null===c&&(c=this.node.lastChild),c.appendChild(a,!0)},g}(),o="undefined"!=typeof exports&&null!==exports?exports:this,null==o.game&&(o.game={}),null==(m=o.game).models&&(m.models={}),o.game.models.Map=f,null==(n=o.game).views&&(n.views={}),o.game.views.Map=g}).call(this);
//# sourceMappingURL=map.min.js.map
(function(){var a,b,c,d;d=document.getElementById("map"),b=new game.models.Map(300,360),c=new game.views.Map(d),a=JSON.parse(b.calculateMap()),c.render(a)}).call(this);
//# sourceMappingURL=app.min.js.map        </script>
    </body>
</html>
