(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e||(e=this.game.views.LeftTopCurve),b||(i=this.game.views.RightTopCurve),d||(d=this.game.views.LeftBottomCurve),h||(h=this.game.views.RightBottomCurve),c||(c=this.game.views.HorizontalStreet),j||(j=this.game.views.VerticalStreet),b||(b=this.game.views.Crossroad),a||(a=this.game.views.Car),f=function(){function a(b,c){this.canvasHeight=b||300,this.canvasWidth=c||300,this.tileHeight=60,this.tileWidth=60,a.SIGNS={LEFT_TOP:"^",RIGHT_TOP:">",RIGHT_BOTTOM:"v",LEFT_BOTTOM:"<",HORIZONTAL:"-",VERTICAL:"|",CROSSROAD:"+",ANY:"?"}}return a.prototype.getCanvasHeight=function(){return this.canvasHeight},a.prototype.getCanvasWidth=function(){return this.canvasWidth},a.prototype.calculateMap=function(){var a,b,c,d,e,f,g,h,i;for(d=this._initMap(),f=d.numRows,e=d.numCols,i=b=0,g=f;0<=g?b<g:b>g;i=0<=g?++b:--b)for(a=c=0,h=e;0<=h?c<h:c>h;a=0<=h?++c:--c)this._setTile([i,a],d);return JSON.stringify({map:d,numRows:d.numRows,numCols:d.numCols})},a.prototype._initMap=function(){var b,c,d,e,f,g,h,i,j;for(g=Math.floor(this.canvasHeight/this.tileHeight),f=Math.floor(this.canvasWidth/this.tileWidth),e=[],e.numRows=g,e.numCols=f,j=c=0,h=g;0<=h?c<h:c>h;j=0<=h?++c:--c)for(e[j]=[],b=d=0,i=f;0<=i?d<i:d>i;b=0<=i?++d:--d)e[j][b]=a.SIGNS.ANY;return e},a.prototype._setTile=function(a,b){var c,d,e,f,g;return g=a[0],c=a[1],f=b.numRows-1,e=b.numCols-1,d={above:g>0?b[g-1][c]:null,below:g<f?b[g+1][c]:null,leftHand:c>0?b[g][c-1]:null,rightHand:c<e?b[g][c+1]:null},b[g][c]=this.pickTile(d),b},a.prototype.pickTile=function(b){var c,d,e,f;return c=this.filterTileCandidates(b),f=function(){var b,d,f;for(f=[],b=0,d=c.length;b<d;b++)e=c[b],e!==a.SIGNS.ANY&&f.push(e);return f}(),d=a.SIGNS.ANY,n.call(c,d)>=0?c=f[Math.floor(Math.random()*f.length)]:c.length>1&&(c=c[Math.floor(Math.random()*c.length)]),c[0]},a.prototype.filterTileCandidates=function(b){var c,d,e,f,g,h,i,j,k;return c={above:[a.SIGNS.LEFT_TOP,a.SIGNS.RIGHT_TOP,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],below:[a.SIGNS.LEFT_BOTTOM,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],leftHand:[a.SIGNS.LEFT_TOP,a.SIGNS.LEFT_BOTTOM,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],rightHand:[a.SIGNS.RIGHT_TOP,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY]},h={top:[null,a.SIGNS.LEFT_TOP,a.SIGNS.RIGHT_TOP,a.SIGNS.VERTICAL],left:[null,a.SIGNS.LEFT_TOP,a.SIGNS.LEFT_BOTTOM,a.SIGNS.HORIZONTAL]},d=function(){var b,c;b=a.SIGNS,c=[];for(g in b)k=b[g],c.push(k);return c}(),e=function(){var a;a=[];for(g in b)k=b[g],a.push(k);return a}(),f=2===e.reduce(function(a,b){return a+(null===b)},0),null===b.above&&(d=d.filter(function(a){return n.call(c.above,a)<0})),null===b.rightHand&&(d=d.filter(function(a){return n.call(c.rightHand,a)<0})),null===b.leftHand&&(d=d.filter(function(a){return n.call(c.leftHand,a)<0})),null===b.below&&(d=d.filter(function(a){return n.call(c.below,a)<0})),f||(i=b.above,n.call(h.top,i)>=0&&(d=d.filter(function(a){return n.call(h.top,a)<0})),j=b.leftHand,n.call(h.left,j)>=0&&(d=d.filter(function(a){return n.call(h.left,a)<0}))),d},a}(),g=function(){function g(a){this.node=a}return g.prototype.render=function(a){var b,c,d,e,f,g,h,i;for(console.log("Translating into DOM:"),console.log(a.map),g=c=0,e=a.numRows;0<=e?c<e:c>e;g=0<=e?++c:--c)for(b=d=0,f=a.numCols;0<=f?d<f:d>f;b=0<=f?++d:--d)h=a.map[g][b],null!==h&&(i=this.getViewForSign(h),this.node.appendChild(i.render()))},g.prototype.getViewForSign=function(a){var g;switch(a){case f.SIGNS.LEFT_TOP:g=e;break;case f.SIGNS.RIGHT_TOP:g=i;break;case f.SIGNS.RIGHT_BOTTOM:g=h;break;case f.SIGNS.LEFT_BOTTOM:g=d;break;case f.SIGNS.HORIZONTAL:g=c;break;case f.SIGNS.VERTICAL:g=j;break;case f.SIGNS.CROSSROAD:g=b}return new g},g.prototype.spawnCar=function(b){var c,d,e;return d=b.numRows*b.numCols,c=Math.floor(Math.random()*d),e=this.node.children.item(c),e.appendChild((new a).render()),e},g}(),m="undefined"!=typeof exports&&null!==exports?exports:this,null==m.game&&(m.game={}),null==(k=m.game).models&&(k.models={}),m.game.models.Map=f,null==(l=m.game).views&&(l.views={}),m.game.views.Map=g}).call(this);
//# sourceMappingURL=map.min.js.map