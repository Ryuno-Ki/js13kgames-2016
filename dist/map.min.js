(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d||(d=this.game.views.LeftTopCurve),a||(h=this.game.views.RightTopCurve),c||(c=this.game.views.LeftBottomCurve),g||(g=this.game.views.RightBottomCurve),b||(b=this.game.views.HorizontalStreet),i||(i=this.game.views.VerticalStreet),a||(a=this.game.views.Crossroad),e=function(){function a(b,c){this.canvasHeight=b||300,this.canvasWidth=c||300,this.tileHeight=60,this.tileWidth=60,a.SIGNS={LEFT_TOP:"^",RIGHT_TOP:">",RIGHT_BOTTOM:"v",LEFT_BOTTOM:"<",HORIZONTAL:"-",VERTICAL:"|",CROSSROAD:"+",ANY:"?"}}return a.prototype.getCanvasHeight=function(){return this.canvasHeight},a.prototype.getCanvasWidth=function(){return this.canvasWidth},a.prototype.calculateMap=function(){var a,b,c,d,e,f,g,h,i;for(d=this._initMap(),f=d.numRows,e=d.numCols,i=b=0,g=f;0<=g?b<g:b>g;i=0<=g?++b:--b)for(a=c=0,h=e;0<=h?c<h:c>h;a=0<=h?++c:--c)this._setTile([i,a],d);return JSON.stringify({map:d,numRows:d.numRows,numCols:d.numCols})},a.prototype._initMap=function(){var b,c,d,e,f,g,h,i,j;for(g=Math.floor(this.canvasHeight/this.tileHeight),f=Math.floor(this.canvasWidth/this.tileWidth),e=[],e.numRows=g,e.numCols=f,j=c=0,h=g;0<=h?c<h:c>h;j=0<=h?++c:--c)for(e[j]=[],b=d=0,i=f;0<=i?d<i:d>i;b=0<=i?++d:--d)e[j][b]=a.SIGNS.ANY;return e},a.prototype._setTile=function(a,b){var c,d,e,f,g;return g=a[0],c=a[1],f=b.numRows-1,e=b.numCols-1,d={above:g>0?b[g-1][c]:null,below:g<f?b[g+1][c]:null,leftHand:c>0?b[g][c-1]:null,rightHand:c<e?b[g][c+1]:null},b[g][c]=this.pickTile(d),b},a.prototype.pickTile=function(b){var c,d,e,f;return c=this.filterTileCandidates(b),f=function(){var b,d,f;for(f=[],b=0,d=c.length;b<d;b++)e=c[b],e!==a.SIGNS.ANY&&f.push(e);return f}(),d=a.SIGNS.ANY,m.call(c,d)>=0?c=f[Math.floor(Math.random()*f.length)]:c.length>1&&(c=c[Math.floor(Math.random()*c.length)]),c[0]},a.prototype.filterTileCandidates=function(b){var c,d,e,f,g,h,i,j,k,l,n,o,p;return d={above:[a.SIGNS.LEFT_TOP,a.SIGNS.RIGHT_TOP,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],below:[a.SIGNS.RIGHT_BOTTOM,a.SIGNS.LEFT_BOTTOM,a.SIGNS.VERTICAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],leftHand:[a.SIGNS.LEFT_BOTTOM,a.SIGNS.LEFT_TOP,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY],rightHand:[a.SIGNS.RIGHT_TOP,a.SIGNS.RIGHT_BOTTOM,a.SIGNS.HORIZONTAL,a.SIGNS.CROSSROAD,a.SIGNS.ANY]},g=[a.SIGNS.LEFT_TOP,a.SIGNS.LEFT_BOTTOM,a.SIGNS.RIGHT_TOP,a.SIGNS.RIGHT_BOTTOM],f=function(){var b,c;b=a.SIGNS,c=[];for(h in b)p=b[h],c.push(p);return c}(),null===b.above&&(f=f.filter(function(a){return m.call(d.above,a)<0})),null===b.rightHand&&(f=f.filter(function(a){return m.call(d.rightHand,a)<0})),null===b.leftHand&&(f=f.filter(function(a){return m.call(d.leftHand,a)<0})),null===b.below&&(f=f.filter(function(a){return m.call(d.below,a)<0})),j=b.above,c=m.call(g,j)>=0,k=b.below,e=m.call(g,k)>=0,l=b.leftHand,i=m.call(g,l)>=0,n=b.rightHand,o=m.call(g,n)>=0,(c||e||i||o)&&(f=f.filter(function(a){return m.call(g,a)<0})),f},a}(),f=function(){function f(a){this.node=a}return f.prototype.render=function(a){var b,c,d,e,f,g,h;for(console.log("Translating into DOM:"),console.log(a.map),e=[],f=c=0,d=a.numRows;0<=d?c<d:c>d;f=0<=d?++c:--c)e.push(function(){var c,d,e;for(e=[],b=c=0,d=a.numCols;0<=d?c<d:c>d;b=0<=d?++c:--c)g=a.map[f][b],h=this.getViewForSign(g),e.push(this.node.appendChild(h.render()));return e}.call(this));return e},f.prototype.getViewForSign=function(f){var j;switch(f){case e.SIGNS.LEFT_TOP:j=d;break;case e.SIGNS.RIGHT_TOP:j=h;break;case e.SIGNS.RIGHT_BOTTOM:j=g;break;case e.SIGNS.LEFT_BOTTOM:j=c;break;case e.SIGNS.HORIZONTAL:j=b;break;case e.SIGNS.VERTICAL:j=i;break;case e.SIGNS.CROSSROAD:j=a}return new j},f}(),l="undefined"!=typeof exports&&null!==exports?exports:this,null==l.game&&(l.game={}),null==(j=l.game).models&&(j.models={}),l.game.models.Map=e,null==(k=l.game).views&&(k.views={}),l.game.views.Map=f}).call(this);
//# sourceMappingURL=map.min.js.map